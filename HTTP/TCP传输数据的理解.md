#### 三个步骤
1. **三次握手**建立连接
2. 传输数据：超时重传、快速重传、流量控制、拥塞控制
3. **四次挥手**断开连接      


![Image](https://user-images.githubusercontent.com/71962217/131844052-34a405a3-a531-4b85-983a-80559265a53e.png)


### 三次握手
第一次握手： 客户端发送syn包到服务器端(seq=x),发送完毕后客户端进入SYN_SEND状态，等待服务器端确认   
第二次握手： 服务器收到syn包，确认ACK=x+1，并发送ACK+SYN包(seq=y)到客户端，发送完毕后服务器进入SYN_RCVD状态   
第三次握手： 客户端收到ACK+SYN包，并向服务器发送确认包ACK（ACK=y+1）,发送完毕客户端和服务器端进入ESTABLISHED状态，完成三次握手。

### 数据传输
1. 超时重传    
   客户端每次发送数据时，都会发送一个带有seq序列号的数据包，服务器端接收到之后会发送ack进行确认。如果一段时间内客户端接收不到这个回复，就会认为是数据丢失，从而重传这个数据包。
   
2. 快速重传   
   当服务器发现数据丢失时，会发送ack告诉客户端数据丢失，客户端会重新发送数据包    
   比如，发送端发送了1 2 3 4 5 五个报文段，接收端依次接受这五个。而在传输过程中2丢失了，在接受到1的时候 接收端发出一个确认1号的ack，表明他接下来想要收到2号。因为2号丢失了，接收到3 4 5的时候 发出的ack还是表明自己需要接受到2号的ack。   
   这样，接收端就接受到了多个一样的ack，即冗余ack。此时，发送端就会触发重传。

3. 流量控制   
   流量控制，通俗来说就是速度匹配服务（匹配发送方的发送速率与接收方的读取速率）
   TCP提供一种基于**滑动窗口协议**的流量控制机制。
   TCP头里有一个字段叫Window，又叫Advertised-Window，这个字段是接收端告诉发送端自己 还有多少缓冲区可以接收数据。于是发送端就可以根据这个接收端的处理能力来发送数据，而不会导致接收端处理不过来。。



4. 拥塞控制    
   拥塞控制是指防止过多的数据注入网络，保证网络中的路由或链路不致过载。
   <b>流量控制只关注发送端和接受端自身的状况，而没有考虑整个网络的通信情况。拥塞控制，则是基于整个网络来考虑的。 </b>  
   考虑一下这 样的场景：某一时刻网络上的延时突然增加，那么，TCP对这个事做出的应对只有重传数据，但是，重传会导致网络的负担更重，于是会导致更大的延迟以及更多 的丢包，于是，这个情况就会进入恶性循环被不断地放大。试想一下，如果一个网络内有成千上万的TCP连接都这么行事，那么马上就会形成“网络风暴”，TCP这个协议就会拖垮整个网络。为此，TCP引入了拥塞控制策略。    
   拥塞策略算法主要包括：**慢启动，拥塞避免，拥塞发生，快速恢复**。

### 四次挥手
第一次挥手：    
主动关闭方发送FIN
第二次挥手：   
第三次挥手：  
第四次挥手：  

